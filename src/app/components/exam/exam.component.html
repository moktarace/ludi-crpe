<div class="exam-container">
  <!-- Configuration de l'examen -->
  <div *ngIf="!examStarted" class="exam-config">
    <div class="config-card">
      <h1>ğŸ“ Mode Examen</h1>
      
      <div class="description">
        <p>â±ï¸ ChronomÃ©trÃ© - EnchaÃ®nement rapide</p>
        <p>ğŸ“š Questions de tous les chapitres mÃ©langÃ©es</p>
        <p>ğŸš« Pas d'aide ni de feedback pendant l'examen</p>
        <p>âœ… Correction dÃ©taillÃ©e Ã  la fin</p>
      </div>

      <div class="chapter-selector">
        <h2>SÃ©lectionner les chapitres :</h2>
        <div class="chapters-grid">
          <button 
            *ngFor="let chapterSel of chapters; let i = index"
            [class.selected]="chapterSel.selected"
            (click)="toggleChapter(i)"
            class="chapter-btn">
            <span class="chapter-icon">{{ chapterSel.chapter.icon }}</span>
            <span class="chapter-name">{{ chapterSel.chapter.title }}</span>
            <span class="mistakes-badge" *ngIf="chapterSel.mistakesCount > 0">
              {{ chapterSel.mistakesCount }}
            </span>
          </button>
        </div>
      </div>

      <div class="duration-selector">
        <h2>Choisir la durÃ©e :</h2>
        <div class="duration-options">
          <button 
            *ngFor="let duration of durations"
            [class.selected]="selectedDuration === duration"
            (click)="selectedDuration = duration"
            class="duration-btn">
            {{ duration }} min
          </button>
        </div>
      </div>

      <button 
        class="start-btn" 
        [disabled]="!hasSelectedChapters"
        (click)="startExam()">
        ğŸš€ Commencer l'examen
      </button>
      
      <p class="warning-text" *ngIf="!hasSelectedChapters">
        âš ï¸ SÃ©lectionnez au moins un chapitre
      </p>
    </div>
  </div>

  <!-- Examen en cours -->
  <div *ngIf="examStarted && !examFinished" class="exam-active">
    <!-- ChronomÃ¨tre -->
    <div class="timer-bar">
      <div class="timer-content">
        <span class="timer-icon">â±ï¸</span>
        <span class="timer-text" [class.warning]="timeRemaining < 60">
          {{ formattedTime }}
        </span>
        <span class="question-counter">
          Question {{ currentQuestionIndex + 1 }} / {{ questions.length }}
        </span>
      </div>
    </div>

    <!-- Question avec composant rÃ©utilisable -->
    <div *ngIf="currentQuestion">
      <div class="chapter-info">
        <span class="chapter-badge">
          ğŸ“š Chapitre {{ currentQuestion!.chapterId.replace('chapter_', '') }}
        </span>
      </div>

      <app-question-display
        [question]="currentQuestion"
        [currentAnswer]="currentAnswer"
        [examMode]="true"
        [showFeedback]="false"
        [showHints]="false"
        (answerSelected)="selectAnswer($event)"
        (answerChanged)="onFreeInputChange($event)">
      </app-question-display>

      <div class="action-buttons">
        <button 
          class="next-btn"
          [disabled]="!canGoNext"
          (click)="nextQuestion()">
          {{ currentQuestionIndex === questions.length - 1 ? 'ğŸ Terminer' : 'Suivant â¡ï¸' }}
        </button>
      </div>
    </div>
  </div>
</div>
