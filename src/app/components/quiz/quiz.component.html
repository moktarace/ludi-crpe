<div class="quiz-container" *ngIf="currentQuestion">
  <div class="quiz-header">
    <button class="exit-button" (click)="exitQuiz()">âœ•</button>
    <div class="progress-container">
      <span class="progress-text">Question {{ currentQuestionIndex + 1 }} / {{ questions.length }}</span>
      <span class="session-badge" *ngIf="!isReviewMode">
        ğŸ¯ Session de 5
      </span>
    </div>
  </div>

  <div class="quiz-content">
    <div class="question-card">
      <div class="question-header">
        <span class="question-type" [ngClass]="currentQuestion.type" *ngIf="FeaturesConfig.showQuestionType">
          <span *ngIf="currentQuestion.type === QuestionType.MULTIPLE_CHOICE">ğŸ“ QCM</span>
          <span *ngIf="currentQuestion.type === QuestionType.FREE_INPUT">âœï¸ RÃ©ponse libre</span>
          <span *ngIf="currentQuestion.type === QuestionType.TRUE_FALSE">âœ“/âœ— Vrai/Faux</span>
        </span>
        <span class="difficulty" [ngClass]="currentQuestion.difficulty">
          {{ currentQuestion.difficulty }}
        </span>
      </div>

      <h2 class="question-text">{{ currentQuestion.question | mathNotation }}</h2>

      <!-- QCM -->
      <div class="answers-grid" *ngIf="currentQuestion.type === QuestionType.MULTIPLE_CHOICE">
        <button 
          *ngFor="let answer of currentQuestion.answers"
          class="answer-button"
          [ngClass]="{
            'selected': selectedAnswer === answer.text && !showFeedback,
            'correct': showFeedback && answer.isCorrect,
            'incorrect': showFeedback && selectedAnswer === answer.text && !answer.isCorrect
          }"
          [disabled]="showFeedback"
          (click)="selectAnswer(answer.text)">
          {{ answer.text }}
        </button>
      </div>

      <!-- RÃ©ponse libre -->
      <div class="free-input" *ngIf="currentQuestion.type === QuestionType.FREE_INPUT">
        <input 
          type="text" 
          class="answer-input"
          [(ngModel)]="userAnswer"
          [disabled]="showFeedback"
          placeholder="Entrez votre rÃ©ponse..."
          (keyup.enter)="submitAnswer()">
      </div>

      <!-- Feedback -->
      <div class="feedback" *ngIf="showFeedback">
        <div class="feedback-message" [ngClass]="{ 'correct': isCorrect, 'incorrect': !isCorrect }">
          <span class="feedback-icon">
            {{ isCorrect ? 'âœ“ Correct !' : 'âœ— Incorrect' }}
          </span>
          
          <!-- Explication mathÃ©matique standard -->
          <div class="explanation-block" *ngIf="!showRealLifeMode">
            <p *ngIf="currentQuestion.explanation" [innerHTML]="currentQuestion.explanation | mathNotation | markdownFormat"></p>
          </div>
          
          <!-- Explication "vie de tous les jours" -->
          <div class="real-life-explanation" *ngIf="showRealLifeMode && currentQuestion.realLifeExplanation">
            <div class="real-life-header">
              <span class="icon">ğŸŒ</span>
              <h4>Dans la vie de tous les jours</h4>
            </div>
            <p [innerHTML]="currentQuestion.realLifeExplanation | mathNotation | markdownFormat"></p>
          </div>
          
          <!-- Bouton pour alterner les modes -->
          <button 
            class="toggle-explanation-btn" 
            (click)="toggleExplanationMode()"
            *ngIf="currentQuestion.realLifeExplanation">
            {{ showRealLifeMode ? 'ğŸ“ Voir l\'explication mathÃ©matique' : 'ğŸŒ Explique-moi comme dans la vie' }}
          </button>
        </div>
      </div>

      <!-- Indices progressifs -->
      <div class="hints-section" *ngIf="currentQuestion.hints && currentQuestion.hints.length > 0 && !showFeedback">
        <button 
          class="hint-button" 
          (click)="showNextHint()"
          [disabled]="!hasMoreHints()">
          ğŸ’¡ Aide ({{ currentHintIndex }}/{{ currentQuestion.hints.length }})
        </button>
        <div class="hints-list" *ngIf="getVisibleHints().length > 0">
          <div class="hint" *ngFor="let hint of getVisibleHints(); let i = index">
            <span class="hint-number">Indice {{ i + 1 }}:</span> <span [innerHTML]="hint | mathNotation | markdownFormat"></span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <button 
          *ngIf="!showFeedback"
          class="btn-submit"
          (click)="submitAnswer()">
          Valider
        </button>
        <button 
          *ngIf="showFeedback"
          class="btn-next"
          (click)="nextQuestion()">
          {{ currentQuestionIndex < questions.length - 1 ? 'Question suivante' : 'Terminer' }}
        </button>
      </div>
    </div>
  </div>
</div>
